<table border="1" cellspacing="0" cellpadding="1" width="100%" bgcolor =" #DCDCDC">
    <tr cellspacing="2" cellpadding="2" >
        <td width=" 40%" rowspan="3" align="center"><b>ÁREAS DE CONHECIMENTO </b></td>
        <td width=" 60%" colspan="9" align="center"><b>MENÇÔES OU NOTAS</b></td>
    </tr>
</table>

<table border="1" cellspacing="0" cellpadding="1" width="100%" bgcolor="#F5F5F5">
    <tr >
        <td width ="30%"rowspan="2"> <b><center>CURRÍCULO BÁSICO   </center> </b></td>
        <td width ="5%" align="center" ><b>1º</b></td>
        <td width ="5%" align="center" ><b>2º</b></td>
        <td width ="5%" align="center" ><b>3º</b></td>
        <td width ="5%" align="center" ><b>4º</b></td>
        <td width ="5%" align="center" ><b>5º</b></td>
        <td width ="5%" align="center" ><b>6º</b></td>
        <td width ="5%" align="center" ><b>7º</b></td>
        <td width ="5%" align="center" ><b>8º</b></td>
        <td width ="5%" align="center" ><b>9º</b></td>
    </tr>
    <% ano = @ano_inicial.ano_letivo %>

    <%if @ano_inicial.classe.nil?%>
        <% classe= @ano_inicial.matricula.classe.classe_classe[0,1].to_i %>
    <%else%>
        <% classe= @ano_inicial.classe %>
    <%end%>
    <% anoinicial = ano.to_i - classe +1  %>
    <tr>
        <%for i in 0..8 %>
            <td width ="5%" align="center" ><b> <%=  anoinicial+i %></b></td>
        <%end%>
    </tr>
    



    <%session[:contnota]=0%>
    <%session[:cargah]=[0, 0, 0, 0, 0, 0, 0, 0, 0]%>
    <%while session[:contnota] < session[:contnotaBTot] %>
        <tr>
            <td align="left"><%= @notasB[session[:contnota]].disciplina.disciplina %> </td>
            <%for i in 0..8%>
                <%if session[:contnota]>(session[:contnotaBTot]-1)%>
                    <%acertoHTML=1%>
                <%else%>
                    <%acertoHTML=session[:contnota]%>
                <%end%>
                <%if (@notasB[acertoHTML].ano_letivo) == (anoinicial+i)%>
                    <td align="center">
                        <%if @notasB[acertoHTML].nota5.nil?%>
                            ---
                        <%else%>
                            <%= @notasB[acertoHTML].nota5%>
                            <%session[:cargah][i]=1%>
                        <%end%>
                        <%if @notasB[acertoHTML].matricula_id.nil?%>
                            &nbsp <%= link_to image_tag("/stylesheets/images/ponto.png", :size => "7x7"), {:action => "destroy_nota", :id =>@notasB[acertoHTML].id}, :confirm => 'Confirma exclusão?', :method => "delete",:title => "Excluir" %>
                        <%end%>
                    </td>
                    <%session[:contnota]=session[:contnota]+1%>
                <%else%>
                    <td align="center">---</td>
                <%end%>
            <%end%>
        </tr>
    <%end%>
    <tr bgcolor =" #DCDCDC">
        <td><b> Carga Horária</b></td>
        <%for i in 0..8%>
            <%if session[:cargah][i]==0%>
                <td align="center">---</td>
            <%else%>
                <td align="center"> <%= 1000 %>  </td>
            <%end%>
        <%end%>
    </tr>
</table>
<% if @notasDisciplinasD.present? %>
    <table border="1" cellspacing="0" cellpadding="1" width="100%" bgcolor="#F5F5F5">
        <tr >
            <td width ="30%"rowspan="2"> <b><center>CURRÍCULO DIVERSIFICADO   </center> </b></td>
            <td width ="5%" align="center" ><b>1º</b></td>
            <td width ="5%" align="center" ><b>2º</b></td>
            <td width ="5%" align="center" ><b>3º</b></td>
            <td width ="5%" align="center" ><b>4º</b></td>
            <td width ="5%" align="center" ><b>5º</b></td>
            <td width ="5%" align="center" ><b>6º</b></td>
            <td width ="5%" align="center" ><b>7º</b></td>
            <td width ="5%" align="center" ><b>8º</b></td>
            <td width ="5%" align="center" ><b>9º</b></td>
        </tr>
        <% ano = @ano_inicial.ano_letivo %>
        <%if @ano_inicial.classe.nil?%>
            <% classe= @ano_inicial.matricula.classe.classe_classe[0,1].to_i %>
        <%else%>
            <% classe= @ano_inicial.classe %>
        <%end%>

        <% anoinicial = ano.to_i - classe + 1  %>
        <tr>
            <%for i in 0..8 %>
                <td width ="5%" align="center" ><b> <%=anoinicial+i %></b></td>
            <%end%>
        </tr>
        <%session[:contnota]=0%>
        <%session[:cargah]=[0, 0, 0, 0, 0, 0, 0, 0, 0]%>
        <%while session[:contnota] < session[:contnotaDTot] %>
            <tr>
                <td align="left"><%= @notasD[session[:contnota]].disciplina.disciplina %> </td>
                <%for i in 0..8%>
                    <%if session[:contnota]>(session[:contnotaDTot]-1)%>
                        <%acertoHTML=1%>
                    <%else%>
                        <%acertoHTML=session[:contnota]%>
                    <%end%>
                    <%if (@notasD[acertoHTML].ano_letivo) == (anoinicial+i)%>
                        <td align="center">   <%if @notasD[acertoHTML].nota5.nil?%>
                                ---
                            <%else%>
                                <%= @notasD[acertoHTML].nota5%>
                                <%session[:cargah][i]=1%>
                            <%end%>
                            <%if @notasD[acertoHTML].matricula_id.nil?%>
                                &nbsp <%= link_to image_tag("/stylesheets/images/ponto.png", :size => "7x7"), {:action => "destroy_nota", :id =>@notasD[acertoHTML].id}, :confirm => 'Confirma exclusão?', :method => "delete",:title => "Excluir" %>
                            <%end%>
                        </td>
                        <%session[:contnota]=session[:contnota]+1%>
                    <%else%>
                        <td align="center">---</td>
                    <%end%>
                <%end%>
            </tr>
        <%end%>

        <tr bgcolor =" #DCDCDC">
            <td><b> Carga Horária</b></td>
            <%for i in 0..8 %>
                <% anoletivo = anoinicial+ i %>
                <% @notasD1= Nota.find(:all, :select=> 'nota5, ano_letivo',:conditions=> ['disciplina_id=? AND aluno_id=? AND ano_letivo=?', 1, session[:aluno_id], anoletivo], :order => 'ano_letivo ASC') %>
                <% if @notasD1.empty?%>
                    <td align="center"> --- </td>
                <%else%>
                    <%for nota in @notasD1%>
                        <%if nota.ano_letivo == anoletivo %>
                            <%if nota.nota5.nil? %>
                                <td align="center"> --- </td>
                            <%else%>
                                <%if session[:notasD]==1%>
                                    <td align="center"> <%= 480 %> </td>
                                <%else%>
                                    <td align="center"> ---  </td>
                                <%end%>

                            <%end%>
                        <%else%>
                            <td align="center"> --- </td>
                        <%end%>
                    <%end%>
                <%end%>
            <%end%>
        </tr>

    </table>

<%end%>

<table border="1" cellspacing="0" cellpadding="1" width="100%" bgcolor="#F5F5F5">
    <tr>
        <td colspan="4"><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
            <b>ESTUDOS REALIZADOS</b><br/><br/></td>
    </tr>

    <tr cellspacing="2" cellpadding="2" bgcolor =" #DCDCDC">
        <td width=" 8%" align="center"><b>Período </b></td>
        <td width=" 10%" align="center"><b>Ano Letivo </b></td>
        <td width=" 60%" align="center"><b>Unidade de Ensino</b></td>
        <td width=" 22%" align="center"><b>Municipio/Estado</b></td>
    </tr>
    <%for i in 0..8 %>
        <% anoletivo = anoinicial+ i %>
        <% @notas= Nota.find(:all, :conditions=> ['aluno_id=? AND ano_letivo=?',  session[:aluno_id], anoletivo], :order => 'ano_letivo ASC') %>
        <tr bgcolor="#F5F5F5">
            <td align="center"><%= i + 1%>º Ano </td>
            <td width ="5%" align="center" > <%=  anoletivo %></td>
            <%  @unidade= Unidade.find(:all, :select => 'unidades.id, unidades.nome, unidades.cidade', :joins=>"INNER JOIN classes ON unidades.id = classes.unidade_id INNER JOIN matriculas ON classes.id = matriculas.classe_id INNER JOIN notas ON matriculas.id = notas.matricula_id", :conditions =>['notas.disciplina_id=? AND notas.aluno_id=? AND notas.ano_letivo=?', 1, session[:aluno_id], anoletivo] )%>
            <%  for unidade in @unidade %>
                <%  session[:unidade]= unidade.nome  %>
                <%  session[:cidade]= unidade.cidade  %>
            <%  end %>
            <td><%if !@unidade.empty? %>
                    <%if  @notas[0].nota5.present? %>
                        <%=  session[:unidade]  %>
                    <%end%>

                <%else%>
                    <% if !@notas[0].nil? %>
                        <%=  session[:unidade1] = @notas[0].escola  %>
                    <%end%>
                    <% if (!nota.nil? and nota.ano_letivo == anoletivo)%>
                        <%= session[:unidade1] %>
                    <%end%>
                <%end%>
            </td>
            <td><%if !@unidade.empty? %>
                    <%if  @notas[0].nota5.present? %>
                        <%=  session[:cidade]  %>
                    <%end%>
                <%else%>
                    <% if !@notas[0].nil? %>
                        <%=  session[:cidade] = @notas[0].cidade  %>
                    <%end%>
                <%end%>
            </td>
        </tr>
    <%end%>
</table>